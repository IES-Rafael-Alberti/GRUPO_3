# Informe pentesting "Pata Palo Corp."

## Índice

1. [Resumen de la evaluación](#1-resumen-de-la-evaluación)
2. [Índices de gravedad de los hallazgos](#2-índices-de-gravedad-de-los-hallazgos)
3. [Factores de riesgo](#3-factores-de-riesgo)
4. [Alcance](#4-alcance)
5. [Resumen ejecutivo](#5-resumen-ejecutivo)  
   5.1. [MS3_Ubuntu](#51-ms3_ubuntu)  
   5.2. [Kiopts](#52-kiopts)  
   5.3.  [W1r3s](#53-w1r3s)
6. [Resumen e informe de vulnerabilidades](#6-resumen-e-informe-de-vulnerabilidades)  
   6.1. [MS3_Ubuntu](#61-ms3_ubuntu)  
   6.2. [Kiopts](#62-kiopts)  
   6.3. [W1r3s](#63-w1r3s)
7. [Resultados técnicos del informe](#7-resultados-técnicos-del-informe)  
   7.1. [MS3_Ubuntu - Resultados](#71-ms3_ubuntu---resultados)  
   7.2. [Kiopts - Resultados](#72-kiopts---resultados)  
   7.3. [W1r3s - Resultados](#73-w1r3s---resultados)
8. [Anexos](#8-anexos)

## 1. Resumen de la evaluación

## 2. Índices de gravedad de los hallazgos

Para valorar la severidad de las vulnerabilidades identificadas durante la evaluación se ha utilizado el sistema CVSS v3 (Common Vulnerability Scoring System), que clasifica los hallazgos en los siguientes niveles:

- **Crítica** (9.0 – 10.0)
- **Alta** (7.0 – 8.9)
- **Media** (4.0 – 6.9)
- **Baja** (0.1 – 3.9)

## 3. Factores de riesgo

- Uso de sistemas operativos obsoletos y sin soporte (MS3_Ubuntu, Kiopts, W1r3s)
- Exposición de servicios vulnerables a través de SMB, RDP, SSH, FTP y HTTP
- Configuraciones por defecto y credenciales débiles
- Servicios accesibles sin autenticación
- Ausencia de medidas de control de acceso y segmentación

## 4. Alcance

El alcance de la evaluación ha abarcado los sistemas definidos por "Pata Palo Corp.", los cuales fueron analizados técnica y prácticamente mediante herramientas de escaneo, explotación y post-explotación.

En todos los sistemas evaluados se logró acceder al mediante explotación de vulnerabilidades, obteniendo sesiones con distintos niveles de privilegios.

| Hostname    | Sistema operativo   | IP            |
| ----------- | ------------------- | ------------- |
| MS3_Ubuntu  | Ubuntu 14.04 LTS    | 10.0.2.129    |
| Kiopts      | CentOS 4.4          | 10.0.2.9      |
| W1r3s       | Ubuntu 16.04        | 10.0.2.15     |

## 5. Resumen ejecutivo

### 5.1. MS3_Ubuntu

En un análisis de seguridad de MS3_Ubuntu, se encontraron vulnerabilidades críticas, altas y medias. Destacan una RCE en el módulo Coder de Drupal, que permite el control remoto del servidor, y una vulnerabilidad en ProFTPD que permite el acceso sin autenticación. También se detectaron configuraciones inseguras en TLS (SWEET32) y el módulo Multiviews de Apache, que exponen directorios. Se recomienda actualizar el software, reconfigurar servicios y eliminar componentes vulnerables.

### 5.2. Kiopts

### 5.3. W1r3s

Se han descubierto  vulnerabilidades  que facilitan el acceso no autorizado a la información y al control total del servidor. Entre ellas está una contraseña débil en el acceso remoto (SSH), la posibilidad de acceder a archivos internos a través de un sitio web mal configurado, y un servidor FTP abierto que expone datos de empleados. Tambien, algunas comunicaciones no están cifradas, lo que permite interceptar contraseñas.

## 6. Resumen e informe de vulnerabilidades

### 6.1. MS3_Ubuntu

- Hallazgo 3:

| **Description of vulnerability** | Drupal Coder Module Deserialization RCE                                                      |
|----------------------------------|----------------------------------------------------------------------------------------------|
| **CVE/CWE**                      | CVE-2014-3704 / CWE-502                                                                      |
| **CVSS v3**                      | 10.0                                                                                         |
| **Severity**                     | Crítica                                                                                      |
| **Impact**                       | Ejecutar comandos arbitrarios en el servidor, comprometiendo completamente el sistema.       |
| **Affected systems**             | Ubuntu 14.04.6 LTS                                                                           |
| **Proof Of Concept (POC)**       | ![alt text](image.png)                                                                       |
| **Remediation**                  | Actualizar Drupal a una versión segura; eliminar módulos vulnerables                         |
| **Reference links**              | <https://www.drupal.org/SA-CORE-2014-005>                                                    |

- Hallazgo 4:

| **Description of vulnerability** | ProFTPD mod_copy Information Disclosure                                                                                          |
|----------------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| **CVE/CWE**                      | CVE-2015-3306 / CWE-306                                                                                                          |
| **CVSS v3**                      | 9.8                                                                                                                              |
| **Severity**                     | Crítica                                                                                                                          |
| **Impact**                       | Permite ejecutar comandos para copiar y pegar en el servidor FTP (SITE CPFR y SITE CPTO) sin la necesidad de estar autenticados. |
| **Affected systems**             | Ubuntu 14.04.6 LTS                                                                                                               |
| **Proof Of Concept (POC)**       | ![alt text](./investigaciones/MS3_Ubuntu/img/ProFTPD1.png) ![alt text](./investigaciones/MS3_Ubuntu/img/ProFTPD2.png)            |
| **Remediation**                  | Deshabilitar mod_copy; actualizar ProFTPD a una versión parchada                                                                 |
| **Reference links**              | <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-3306>                                                                   |

### 6.2. Kiopts

| Description of vulnerability|                                                                             |
|-----------------------------|-----------------------------------------------------------------------------|
| **CVE/CWE**                 |  /                                                                          |
| **CVSS v3**                 |                                                                             |
| **Severity**                |                                                                             |
| **Impact**                  |                                                                             |
| **Affected systems**        |                                                                             |
| **Proof Of Concept (POC)**  |                                                                             |
| **Remediation**             |                                                                             |
| **Reference links**         |                                                                             |

### 6.3. W1r3s

| **Description of vulnerability** | Contraseña débil (fuerza bruta) y acceso SSH sin medidas de protección.                            |
|----------------------------------|----------------------------------------------------------------------------------------------------|
| **CVE/CWE**                      | CVE-2016-6210 / CWE-521: Weak Password Requirements                                                |
| **CVSS v3**                      | 8.8                                                                                                |
| **Severity**                     | Alta                                                                                               |
| **Impact**                       | Acceso remoto no autorizado, escalada a root, posible compromiso total                             |
| **Affected systems**             | Sistema Linux (Ubuntu 16.04.3 LTS), servicio SSH                                                   |
| **Proof Of Concept (POC)**       | Hydra → acceso con `computer`; `ssh` → acceso exitoso a w1r3s                                      |
| **Remediation**                  | Usar contraseñas fuertes, limitar intentos SSH, usar autenticación con clave pública               |
| **Reference links**              | <https://cwe.mitre.org/data/definitions/521.html> <https://nvd.nist.gov/vuln/detail/CVE-2016-6210> |

- Hallazgo 4:

| **Description of vulnerability** | Acceso no autenticado a un panel de instalación                                                |
|----------------------------------|------------------------------------------------------------------------------------------------|
| **CVE/CWE**                      | NA / CWE-306: Missing Authentic for Critical Function                                          |
| **CVSS v3**                      | 8.8                                                                                            |
| **Severity**                     | Alta                                                                                           |
| **Impact**                       | Permite la configuración maliciosa del sistema por parte de un atacante                        |
| **Affected systems**             | Sistema Linux (Ubuntu 16.04.3 LTS)                                                             |
| **Proof Of Concept (POC)**       | ![alt text](./investigaciones/W1r3s/img/13.png) ![alt text](./investigaciones/W1r3s/img/5.png) |
| **Remediation**                  | Eliminar o restringir el acceso al instalador tras la instalación                              |
| **Reference links**              | <https://owasp.org/Top10/A01_2021-Broken_Access_Control/>                                      |

## 7. Resultados técnicos del informe

### 7.1. MS3_Ubuntu - Resultados

El análisis nos mostró que el servidor tiene varias vulnerabilidades críticas y medias. La primera es una ejecución remota de comandos en Drupal debido a una deserialización insegura en el módulo Coder, lo que permite tomar control total del servidor. También se detectó una grave vulnerabilidad en ProFTPD que permite la copia de archivos sin necesidad de autenticación, exponiendo datos sensibles del sistema. Además, el servidor utiliza cifrados débiles como 3DES, lo que lo hace vulnerable a ataques SWEET32. Por último, se encontró que el módulo Multiviews de Apache está mal configurado, lo que permite la exposición no autorizada de archivos en el servidor. Para mitigar estos riesgos, se recomienda actualizar Drupal y ProFTPD, deshabilitar cifrados débiles y ajustar la configuración de Apache.

### 7.2. Kiopts - Resultados

### 7.3. W1r3s - Resultados

El análisis nos dió que el servidor  tiene abiertos los puertos 21 (FTP), 22 (SSH), 80 (HTTP) y 3306 (MySQL), todos con problemas de seguridad. El CMS cuppa, en el puerto 80, tiene un panel de instalación sin protección y es vulnerable a inclusión de archivos,  lo que nos permitió leer /etc/passwd. Se entro en  SSH con hydra y nos dió la contraseña "computer" y luego escalar a root con sudo su. El FTP permite conexión anónima y expone datos internos. Tambien, se capturaron credenciales en texto claro con Wireshark. Por último, el servidor SSH es vulnerable a Terrapin (CVE-2023-48795), lo que habilita ataques man in the middle.

## 8. Anexos

La declaración de confidencialidad, el descargo de responsabilidad y más anexos se recogen en el siguiente documento:

[Anexos pentesting](./AnexoPentesting.md)

<img src="img/israelSignWhite.png" alt="firma victor" width="150"/>
<img src="img/victorSignWhite.png" alt="firma Isra" width="200"/>
